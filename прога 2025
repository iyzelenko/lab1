import tkinter as tk
from PIL import Image, ImageTk
import threading
import random
import time
import pygame
import os
import heapq

pygame.mixer.init()

class Cockroach:
    def __init__(self, power, mutation):
        self.power = power
        self.mutation = mutation

    def __repr__(self):
        return f"–¢–∞—Ä–∞–∫–∞–Ω(–º–æ—â—å={self.power}, –º—É—Ç–∞—Ü–∏—è='{self.mutation}')"

class Node:
    def __init__(self, x, y, g=0, h=0, parent=None):
        self.x = x
        self.y = y
        self.g = g
        self.h = h
        self.f = g + h
        self.parent = parent

    def __lt__(self, other):
        return self.f < other.f

class CockroachGame:
    def __init__(self, root):
        self.root = root
        self.root.title("–¢–∞—Ä–∞–∫–∞–Ω –£–ª—å—Ç—Ä–∞")
        self.root.geometry("1200x900")

        self.power = 1
        self.mutation = "–û–±—ã—á–Ω—ã–π —Ç–∞—Ä–∞–∫–∞–Ω"

        self.image_files = [f"cockroach_{i}.jpeg" for i in range(1, 6)]
        self.images = [Image.open(file).resize((150, 150), Image.LANCZOS) for file in self.image_files]

        self.angle = 0
        self.running = False
        self.rotating = False
        self.rotation_direction = 1
        self.animation_speed = 0.2
        self.dance_active = False
        self.bg_colors = ["lightblue", "lightgreen", "lightpink", "lightyellow", "lavender", "orange", "red"]
        self.current_color_index = 0
        self.sorting = False
        self.astar_active = False

        self.label_power = tk.Label(root, text=f"–ú–æ—â—å —Ç–∞—Ä–∞–∫–∞–Ω–∞: {self.power}", font=("Arial", 14))
        self.label_power.pack()

        self.label_mutation = tk.Label(root, text=f"–ú—É—Ç–∞—Ü–∏—è: {self.mutation}", font=("Arial", 12))
        self.label_mutation.pack()

        self.canvas = tk.Canvas(root, width=700, height=400, bg="lightblue")
        self.canvas.pack()

        self.chart_canvas = tk.Canvas(root, width=700, height=200, bg="white")
        self.chart_canvas.pack(pady=10)

        self.path_canvas = tk.Canvas(root, width=700, height=200, bg="lightgrey")
        self.path_canvas.pack(pady=10)

        self.tk_image = None
        self.image_id = None
        self.x_pos = 350
        self.y_pos = 200
        self.update_image()

        buttons = [
            ("–ö–ª–∏–∫!", self.click),
            ("–ü–æ–≤–µ—Ä–Ω—É—Ç—å", self.rotate),
            ("–ù–∞—á–∞—Ç—å –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ", self.start_rotation),
            ("–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–Ω–∏–µ", self.stop_rotation),
            ("–°–º–µ–Ω–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ", self.change_rotation),
            ("–°—Ç–∞—Ä—Ç –∞–Ω–∏–º–∞—Ü–∏–∏", self.start_animation),
            ("–°—Ç–æ–ø –∞–Ω–∏–º–∞—Ü–∏–∏", self.stop_animation),
            ("–£—Å–∫–æ—Ä–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é", self.speed_up),
            ("–°–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç —Ñ–æ–Ω–∞", self.change_background_color),
            ("üíÉ –¢–∞–Ω–µ—Ü + –º—É–∑—ã–∫–∞!", self.start_dance_party),
            ("–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞—Ä–∞–∫–∞–Ω–æ–≤", self.start_sorting_thread),
            ("A* –ø–æ–∏—Å–∫ –ø—É—Ç–∏", self.start_astar_thread),
        ]
        for text, command in buttons:
            tk.Button(root, text=text, command=command).pack(pady=2)

        self.root.bind("<Left>", self.move_left)
        self.root.bind("<Right>", self.move_right)
        self.root.bind("<Up>", self.move_up)
        self.root.bind("<Down>", self.move_down)

        self.cockroach_list = [
            Cockroach(random.randint(10, 100), random.choice(["–æ–±—ã—á–Ω—ã–π", "—Å–∏–ª—å–Ω—ã–π", "–≥–∏–≥–∞–Ω—Ç—Å–∫–∏–π"]))
            for _ in range(10)
        ]

        threading.Thread(target=self.animate_images, daemon=True).start()
        threading.Thread(target=self.auto_rotate, daemon=True).start()

        self.draw_chart()

    def start_astar_thread(self):
        if not self.astar_active:
            threading.Thread(target=self.run_astar, daemon=True).start()

    def run_astar(self):
        self.astar_active = True
        rows, cols = 10, 20
        grid = [[0]*cols for _ in range(rows)]
        start, goal = (0, 0), (9, 19)

        def heuristic(a, b):
            return abs(a[0] - b[0]) + abs(a[1] - b[1])

        open_list = []
        heapq.heappush(open_list, Node(*start, h=heuristic(start, goal)))
        closed_set = set()
        came_from = {}

        while open_list:
            current = heapq.heappop(open_list)
            if (current.x, current.y) == goal:
                path = []
                while current:
                    path.append((current.x, current.y))
                    current = current.parent
                self.draw_path(path[::-1])
                break

            closed_set.add((current.x, current.y))
            for dx, dy in [(-1,0),(1,0),(0,-1),(0,1)]:
                nx, ny = current.x + dx, current.y + dy
                if 0 <= nx < rows and 0 <= ny < cols and (nx, ny) not in closed_set:
                    neighbor = Node(nx, ny, current.g + 1, heuristic((nx, ny), goal), current)
                    heapq.heappush(open_list, neighbor)
            time.sleep(0.05)

        self.astar_active = False

    def draw_path(self, path):
        self.path_canvas.delete("all")
        size = 20
        for (x, y) in path:
            self.path_canvas.create_rectangle(y*size, x*size, y*size+size, x*size+size, fill="blue")

    # –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ –∏–∑–º–µ–Ω—è–ª–∏—Å—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è –Ω–∏–∂–µ...
